{% extends "base.html" %}

{% block title %}Recycling Batches{% endblock %}

{% block content %}
<h2>Recycling Batches</h2>

<p><a href="{{ url_for('create_batch') }}">+ Create New Batch</a></p>

<table border="1" cellpadding="5">
    <thead>
        <tr>
            <th>ID</th>
            <th>Batch Name</th>
            <th>Facility</th>
            <th>Status</th>
            <th>Items</th>
            <th>Weight (kg)</th>
            <th>Recovery Rate (%)</th>
            <th>Created</th>
            <th>Start Date</th>
            <th>End Date</th>
            
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for batch in batches %}
        <tr>
            <td>{{ batch.batch_id }}</td>
            <td>{{ batch.batch_name }}</td>
            <td>{{ batch.facility_name }}</td>
            <td><strong>{{ batch.status }}</strong></td>
            <td>{{ batch.item_count }}</td>
            <td>{{ "%.2f"|format(batch.total_weight_kg or 0) }}</td>
            <td>{{ "%.2f"|format(batch.recovery_rate_percentage or 0) if batch.recovery_rate_percentage else '-' }}</td>
            <td>{{ batch.created_date }}</td>
            <td>{{ batch.processing_start_date or '-' }}</td>
            <td>{{ batch.processing_end_date or '-' }}</td>
            
            <td>
                {% if batch.status == 'open' %}
                <a href="{{ url_for('add_to_batch', batch_id=batch.batch_id) }}">Add Items</a> |
                <a href="{{ url_for('start_batch', batch_id=batch.batch_id) }}">Start Processing</a>
                {% elif batch.status == 'processing' %}
                <a href="{{ url_for('complete_batch', batch_id=batch.batch_id) }}">Complete</a>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
